---
title: "Resample Plot"
author: "Eva Brigos"
date: "2025-03-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load libraries
```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
```


# tSDS

```{r}
# Load datagrame
input <- read.csv("../data/fertility_SDS_earliest_resampling_results.csv", sep = ",")

# Separate the two groups
positive_values <- input$Positive_Pleios_Mean
negative_values <- input$Negative_Pleios_Mean
# Generate the label
positive_label <- rep("Positive", length(positive_values))
negative_label <- rep("Negative", length(negative_values))
# Concatenate
Positive <- data.frame(Values = positive_values, Label = positive_label)
Negative <- data.frame(Values = negative_values, Label = negative_label)
# Combine the two groups
df <- rbind(Positive, Negative)
```

The x-intercepts for positive and negative pleiotropies are our observed
means for each group. I can check these values on the summary txt file
outputed from the *do_resampling.py* script.

```{r}
# Plot the two distributions
p1 <- ggplot(df, aes(x = Values, fill = Label)) +
  geom_histogram(alpha = 0.5, position = "identity", bins = 50) +  # Plot both distributions
  geom_vline(xintercept = 0.2337, linetype = "solid", color = "blue", linewidth = 1) +
  geom_vline(xintercept = -0.3239, linetype = "solid", color = "red", linewidth = 1) +
  labs(x = "Singleton Density Score (SDS)", y = "Frequency", fill = "Label") +
  theme_classic() +
  scale_fill_manual(values = c("Positive" = "red", "Negative" = "blue"),
                    labels = c("Positive Pleiotropies", "Negative Pleiotropies")) +
  theme(legend.position = c(0.95,0.9), legend.title = element_blank(),
        axis.text = element_text(size = 7), axis.title = element_text(size = 7, face = "bold"),
        axis.text.x = element_text(margin = margin(t = 10)),
        axis.text.y = element_text(margin = margin(r = 10)),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.text = element_text(size = 7),
        axis.line = element_line(color = "black"),
        axis.ticks = element_line(colour = "black", lineend = "round"),
        plot.margin = margin(t = 10, r = 30, b = 10, l = 10))
```

The x-intercept for is our observed MW p-value between the means of positive and
negative pleiotropies. I can check this value on the summary txt file
outputed from the *do_resampling.py* script.

```{r}
# Plot the p-values
p2 <- ggplot(input, aes(x = MW_P_Value)) +
  geom_histogram(alpha = 0.8, position = "identity", bins = 150, aes(fill = MW_P_Value < 0.05)) +
  scale_fill_manual(values = c("TRUE" = "orange", "FALSE" = "azure4"), guide = "none") +
  scale_x_continuous(breaks = waiver(), n.breaks = 15) +
  geom_vline(xintercept = 0.000537, linetype = "solid", color = "black", linewidth = 1) +
  labs(x = "Two-sided Mann-Whitney P-value", y = "Frequency") +
  theme_classic() +
  theme(legend.position = "none",
        axis.text = element_text(size = 7), axis.title = element_text(size = 7, face = "bold"),
        axis.text.x = element_text(margin = margin(t = 10)),
        axis.text.y = element_text(margin = margin(r = 10)),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        axis.line = element_line(color = "black"),
        axis.ticks = element_line(colour = "black", lineend = "round"),
        plot.margin = margin(t = 10, r = 30, b = 10, l = 10))
```

# Aggregated plot

```{r}
f1 <- plot_grid(p1, p2,
  ncol = 1,
  labels = c("a", "b"),
  label_fontface = "bold",
  label_fontfamily = "Arial",
  label_size = 10,
  align = "v",   # Align vertically
  rel_widths = c(1, 1)
)

```

# Save the plot

```{r}
ggsave("./aggregated_plot_resampling_SDS_fertility.png",
       f1, 
       height = 170, width = 180, units = "mm", dpi = 400)
```

